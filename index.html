<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quiz Practice</title>
<style>
  body { font-family: Arial; max-width:1200px; margin:20px auto; font-size:25px; }
  .question { margin-bottom:20px; padding:15px; border:1px solid #ccc; border-radius:8px; }
  .question h3 { margin-bottom:8px; }
  textarea, input[type=text] { font-size:25px; }
  .underline-input { border:none; border-bottom:2px solid #000; outline:none; width:150px; }
  .comprehension-container { display:flex; gap:20px; }
  .comprehension-passage { flex:3; padding:15px; border:1px solid #ccc; overflow:auto; max-height:600px; }
  .comprehension-questions { flex:2; padding:15px; border:1px solid #ccc; overflow:auto; max-height:800px; }
  img { display:block; margin-bottom:5px; max-width:100%; }
  .img-row { display:flex; gap:10px; margin-bottom:10px; }
  .img-row div { text-align:center; }
  button { margin-top:10px; padding:5px 10px; }
</style>
</head>
<body>
  <h1>Quiz Practice</h1>
  <div id="quiz"></div>

  <script>
  // 模擬 fetch 回 data
  const allQuestions = [ /* 放你的資料，比如 JSON 類似 Q008 的格式 */ ];

  const quiz = document.getElementById('quiz');
  function render() {
    quiz.innerHTML = '';
    allQuestions.forEach((q, idx) => {
      const c = document.createElement('div'); c.className = 'question';
      const h = document.createElement('h3'); h.textContent = `${idx+1}. ${q.instruction}`; c.appendChild(h);
      if (q.Type === 'fill-in') {
        const p = document.createElement('p');
        const parts = q.question.split('___');
        const answers = q.answer;
        parts.forEach((t,i) => {
          p.appendChild(document.createTextNode(t));
          if (i < answers.length) {
            const inp = document.createElement('input');
            inp.type = 'text'; inp.className='underline-input';
            inp.dataset.answer = answers[i].toLowerCase();
            p.appendChild(inp);
          }
        });
        c.appendChild(p);
      }
      else if (q.Type === 'mc') {
        const p = document.createElement('p'); p.textContent = q.question; c.appendChild(p);
        ['A','B','C','D'].forEach(opt => {
          if (q[opt]) {
            const l = document.createElement('label');
            const r = document.createElement('input');
            r.type='radio'; r.name='q'+idx; r.value=opt;
            l.appendChild(r); l.appendChild(document.createTextNode(' '+q[opt]));
            c.appendChild(l); c.appendChild(document.createElement('br'));
          }
        });
      }
      else if (q.Type === 'match-image') {
        const p = document.createElement('p'); p.textContent = q.question; c.appendChild(p);
        const imgs = JSON.parse(q.imageSet);
        const div = document.createElement('div'); div.className = 'img-row';
        imgs.forEach((url,i) => {
          const wr = document.createElement('div');
          const img = document.createElement('img'); img.src=url; img.style.width='150px';
          const inp = document.createElement('input'); inp.type='text'; inp.placeholder = `Image ${i+1}`;
          wr.appendChild(img); wr.appendChild(inp);
          div.appendChild(wr);
        });
        c.appendChild(div);
      }
      else if (q.Type === 'comprehension') {
        const data = JSON.parse(q.question);
        const wrap = document.createElement('div'); wrap.className='comprehension-container';
        const pas = document.createElement('div'); pas.className='comprehension-passage';
        pas.innerHTML = data.text.replace(/\n/g,'<br>');
        wrap.appendChild(pas);
        const qblock = document.createElement('div'); qblock.className='comprehension-questions';
        const imgs = JSON.parse(q.imageSet||'[]');
        data.questions.forEach((itm,i) => {
          const wr = document.createElement('div');
          const tp = itm.type;
          const num = i+1;
          if (tp === 'fill-in') {
            const p = document.createElement('p');
            p.textContent = `${num}. `;
            const parts = itm.text.split('___');
            p.appendChild(document.createTextNode(parts[0]));
            const inp = document.createElement('input');
            inp.className='underline-input';
            inp.dataset.answer = q.answer[i].toLowerCase();
            p.appendChild(inp);
            p.appendChild(document.createTextNode(parts[1]||''));
            wr.appendChild(p);
          }
          else if (tp === 'match-image') {
            const p = document.createElement('p');
            p.textContent = `${num}. ${itm.text}`;
            wr.appendChild(p);
            const div = document.createElement('div'); div.className = 'img-row';
            imgs.forEach((url,j) => {
              const dr = document.createElement('div');
              const img = document.createElement('img'); img.src=url; img.style.width='150px';
              const inp = document.createElement('input'); inp.type='text'; inp.placeholder=`Image ${j+1}`;
              dr.appendChild(img); dr.appendChild(inp);
              div.appendChild(dr);
            });
            wr.appendChild(div);
          }
          else if (tp === 'mc') {
            const p = document.createElement('p');
            p.textContent = `${num}. ${itm.text}`;
            wr.appendChild(p);
            ['A','B','C','D'].forEach(opt => {
              if (itm[opt]) {
                const l = document.createElement('label');
                const r = document.createElement('input');
                r.type='radio'; r.name=`q${idx}_${i}`; r.value=opt;
                l.appendChild(r); l.appendChild(document.createTextNode(' '+itm[opt]));
                wr.appendChild(l); wr.appendChild(document.createElement('br'));
              }
            });
          }
          else {
            const p = document.createElement('p');
            p.textContent = `${num}. ${itm.text}`;
            wr.appendChild(p);
            const ta = document.createElement('textarea');
            wr.appendChild(ta);
          }
          qblock.appendChild(wr);
        });
        wrap.appendChild(qblock);
        c.appendChild(wrap);
      }

      // Submit 按鈕
      const sb = document.createElement('button');
      sb.textContent = 'Submit';
      sb.onclick = () => {
        let correct = 0, total = 0;
        // fill-in inputs
        c.querySelectorAll('input[type=text].underline-input').forEach(inp => {
          total++;
          if (inp.value.trim().toLowerCase() === inp.dataset.answer) {
            correct++;
            inp.style.borderColor='green';
          } else inp.style.borderColor='red';
          inp.disabled = true;
        });
        // mc
        c.querySelectorAll('input[type=radio]').forEach(r => {
          total++;
          if (r.checked) {
            const isOk = (allQuestions[idx].Type==='mc' && r.value === allQuestions[idx].answer)
              || (allQuestions[idx].Type==='comprehension' &&
                 allQuestions[idx].answer[i] === r.value);
            if (isOk) {
              correct++; r.parentNode.style.color='green';
            } else r.parentNode.style.color='red';
            r.disabled = true;
          }
        });
        sb.disabled = true;
        alert(`Score: ${correct} / ${total}`);
      };
      c.appendChild(sb);

      quiz.appendChild(c);
    });
  }

  render();
  </script>
</body>
</html>

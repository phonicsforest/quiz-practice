<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Practice</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: auto; padding: 20px; }
    .question { border: 1px solid #ccc; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
    input[type="text"] { width: 150px; }
    .result { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Quiz Practice</h1>
  <div id="quiz"></div>

  <script>
    fetch("https://script.google.com/macros/s/YOUR_DEPLOYED_SCRIPT_URL/exec")
      .then(res => res.json())
      .then(data => {
        const quizContainer = document.getElementById("quiz");

        data.forEach((q, qIndex) => {
          const container = document.createElement("div");
          container.className = "question";

          const title = document.createElement("h3");
          title.textContent = `${qIndex + 1}. ${q.question || "Fill in the blanks"}`;
          container.appendChild(title);

          if (q.Type === "mc") {
            ["A", "B", "C", "D"].forEach(opt => {
              if (q[opt]) {
                const label = document.createElement("label");
                label.innerHTML = `<input type="radio" name="q${qIndex}" value="${opt}"> ${q[opt]}`;
                container.appendChild(label);
                container.appendChild(document.createElement("br"));
              }
            });
          } else if (q.Type === "fill-in") {
            const text = q.question;
            const answers = JSON.parse(q.Answer); // array of expected answers
            const parts = text.split("___");

            parts.forEach((part, i) => {
              container.appendChild(document.createTextNode(part));
              if (i < answers.length) {
                const input = document.createElement("input");
                input.type = "text";
                input.dataset.answer = answers[i].toLowerCase();
                container.appendChild(input);
              }
            });

            const checkBtn = document.createElement("button");
            checkBtn.textContent = "Check";
            container.appendChild(document.createElement("br"));
            container.appendChild(checkBtn);

            const result = document.createElement("div");
            result.className = "result";
            container.appendChild(result);

            checkBtn.onclick = () => {
              let correct = 0;
              let total = answers.length;
              container.querySelectorAll("input[type=text]").forEach(input => {
                const userAns = input.value.trim().toLowerCase();
                const correctAns = input.dataset.answer;
                if (userAns === correctAns) {
                  input.style.borderColor = "green";
                  correct++;
                } else {
                  input.style.borderColor = "red";
                }
              });
              result.textContent = `✅ ${correct} / ${total} 正確`;
            };
          }

          quizContainer.appendChild(container);
        });
      });
  </script>
</body>
</html>
